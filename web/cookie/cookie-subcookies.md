# Subcookies

브라우저마다 다른 쿠키 수 제한으로 호환성 문제가 발생할 수 있다. 그래서 나온 것이 서브쿠키이다. 서브쿠키는 "쿠키 값 내에 저장되는" { name - value } pair 이다.

```http
nane=a=b&c=d&g=h
```

서브쿠키는 하나의 쿠키 내에 여러 개의 "name - value" 을 저장할 수 있어 브라우저의 쿠키 수 제한을 피할 수 있다.

하지만, 값을 추출하기 위한 파싱 과정이 필요하고 단순한 형식의 쿠키를 사용하는 것보다 복잡하다.

일부 프레임워크는 서브쿠키의 읽기 / 쓰기를 지원하고 있고 자바스크립트 라이브러리에서도 지원한다. 서브쿠키의 사용으로 도메인 당 쿠키 수 제한을 피하면서도 웹 사이트가 필요한 정보를 모두 저장할 수 있게 된다. ( 브라우저 간 호환성 문제를 줄이고 UX 뿜뿜 )

## 자바스크립트 코드

자바스크립트에서 `document.cookie` 를 통해 쿠키 값을 설정하고 읽을 수 있다.

```js
// Set-Cookie Header 역할
// document.cookie = ~ 는 document.cookie 전체를 덮어 쓰는 것이 아니라 추가한다고 보면 된다. (기존의 것이 수정될 수는 있음)
document.cookie = "name1=rare; domain=test.net; path=/";
document.cookie = "name2=pepe";

// Cookie Header 역할
// document.cookie 읽기
("name1=rare; name2=pepe");
```

자바스크립트에서 쿠키를 파싱하는 코드를 직접 작성할 수 있지만 라이브러리를 이용하는 것이 좋다.

> 👀 자바스크립트를 통해 설정된 쿠키의 옵션들을 검색할 수는 없다. (기록해둬야하나...?)

**자바스크립트를 통해 쿠키에 접근하기 위해 충족해야 하는 조건들이 있다.**

- Same Domain : **페이지와 쿠키의 도메인이 일치해야 한다.** 이를 통해 다른 도메인의 페이지가 해당 쿠키에 접근하는 것을 방지한다.
  - `test.net`에서 설정된 쿠키는 `test.net`도메인의 페이지에서만 읽을 수 있다.
- Same Path : **쿠키가 설정된 경로와 페이지의 경로가 일치해야 한다.** 동일한 경로와 그 하위 경로에서만 쿠키에 접근할 수 있도록 한다.
  - /blog 로 설정된 쿠키는 /blog , /blog/... 페이지에서만 접근할 수 있다.
- Same Secure : HTTPS로 설정된 쿠키는 HTTPS에서만, HTTP로 설정된 쿠키는 HTTP에서만 접근할 수 있다.

위의 조건들로 사용자의 정보를 더욱 안전하게 보호할 수 있다.
