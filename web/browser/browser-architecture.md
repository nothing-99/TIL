# 브라우저 아키텍처

애플리케이션을 시작하면 운영체제는 하나의 프로세스와 이를 위한 메모리 공간을 할당한다. 이 메모리 공간에는 프로세스 실행에 있어 필요한 데이터들이 모두 저장되고 애플리케이션을 닫으면 프로세스가 사라지고 메모리는 회수된다.

프로세스를 실행 중 다른 작업을 수행하기 위해 운영체제에 다른 프로세스를 할당해 실행하도록 요청할 수 있다. 이 프로세스 간에 데이터를 공유하기 위해서 IPC를 사용한다

> IPC (Inter-Process Communication)
> 각 프로세스는 독립적인 메모리 공간을 가지고 있고 프로세스 간에 정보를 공유할 방법이 필요한데 이것을 가농토록 하는 메커니즘이다. 즉, 프로세스들이 서로 통신하고 동기화할 수 있도록 한다.

## 브라우저 아키텍처 (Chrome)

제일 상단에 브라우저 프로세스가 있고 애플리케이션의 각 부분을 맡고 있는 다른 프로세스들을 컨트롤한다. 별도의 프로세스들이 별도의 작업을 독립적으로 수행하기 때문에 **브라우저의 안정성과 보안이 향상**된다

- 브라우저 프로세스 : 브라우저의 모든 UI를 처리하고 네트워크 요청이나 파일 접근과 같은 눈에 보이지 않지만 권한이 필요한 부분도 처리한다.
- 렌더러 프로세스 : 웹 사이트가 표시되는 부분의 모든 것을 처리한다
- 플러그인 프로세스 : 웹 사이트에서 사용하는 플러그들을 제어한다.
- GPU 프로세스 : GPU 작업을 다른 프로세스와 격리해서 처리한다.

크롬은 탭마다 프로세스를 할당하고 렌더링 엔진, 자바스크립트 엔진을 가지도록 하여 독립적으로 동작하도록 한다. 이로 인해 크롬에서는 하나의 탭에서 발생한 문제가 다른 탭에는 영향을 끼치지 않는다.

## 다중 프로세스 아키텍쳐가 크롬에 주는 이점

- 탭당 하나의 프로세스 할당 : 탭에서 발생한 문제 확산 방지
- 탭당 하나의 렌더러 프로세스 할당 : 브라우저의 안정성, UX
- 브라우저의 작업별로 프로세스 할당 : 보안성 강화. 잠재적 위험이 있는 작업을 수행하는 프로세스가 시스템의 중요한 리소스에 접근하지 못하도록 할 수 있다. (샌드박스 기능)

**크롬이 다중 프로세스 아키텍처로 인해 메모리는 많이 사용하지만 빠른 UX와 보안을 제공한다는 장점이 있다.**

## 메모리 절약을 위한 서비스

제한된 하드웨어에서 메모리 사용량을 줄이기 위해 브라우저가 제공하는 서비스들을 통합해서 하나의 프로세스가 처리하도록 할 수 있다. 그 반대 경우에는 각 서비스별로 프로세스를 할당 해 성능을 향상시킬 수 있다.

**이것은 브라우저의 안정성과 메모리 효율성을 동시에 증가시킬 수 있다.**

## 사이트 격리

각 탭마다 하나의 렌더링 프로세스를 할당할 경우 탭에 ifram사이트가 같은 렌더링 프로세스에 의해 동작하기에 메모리 공유의 문제가 따른다.

이것은 same-origin policy를 위반하기에 보안 공격에 노출된다.

ifram과 메인 사이트의 렌더링 프로세스를 격리하는 것이 효과적인 방법이다. 크롬에서는 이를 디폴트로 제공하는 기능이다.

### Same-Origin Policy (동일 출처 정책)

서로 다른 origin에서 가져온 리소스가 상호작용하는 것을 제한하는 중요한 보안 방식이다. same-origin은 protocol, port, host-name 3개가 모두 같아야 한다.

`https://nft.rareapepe.com/origin/index.html`

- `https` : 프로토콜
- `nft.rareapepe.com` : 호스트 이름
- `:443` : https의 기본 포트 (http는 80)
- 뒤의 path는 상관없음

### Site Isolation

크롬의 보안 기능 중 하나로, 각 웹 사이트와 관련 리소스를 독립된 프로레스에서 실행하여 보안을 강화하는 방식이다. 웹 사이트 간의 정보 유출을 방지하며, 특히 멜트다운, 스펙터 같은 하드웨어 취약점을 이용한 공격으로부터 사용자를 보호하기 위해 도입되었다.

- 각 도메인에 대해 독립된 렌더링 프로세스를 생성한다. 한 사이트에서 발생한 문제가 다른 사이트에 영향을 끼치지 않게 된다.
- ifram에 대해서도 독립된 프로세스를 할당한다. 메인 사이트와 ifram 에 있는 사이트 간의 데이터 유출이 발생하지 않도록 한다.
- 렌더링 프로세스 간의 직접적인 데이터 공유를 제한한다. 프로세스 간의 데이터 탈취를 방지한다.

#### Spectre, Meltdown

공격자가 시스템에서 보호되어야 할 민감한 정보를 탈취할 수 있게 하는 취약점이다.

- Spectre(스펙터) : 프로세서의 branch prediction 기능을 악용하여 접근할 수 없는 메모리 영역에서 데이터를 읽어오는 공격이다. 프로세서는 성능 향상을 위해 가까운 미래에 실행시킬 명령어를 예측하여 미리 실행시켜 놓는데 이 과정에서 발생하는 캐시변화를 분석하여 접근할 수 없는 데이터를 탈취한다.
- Meltdown(멜트다운) : 프로세서의 Speculative execution 기능을 악용하는 공격으로 스펙 실행 과정에서 발생하는 정보 누출을 이용하여 사용자 보드에서 커널 메모리 영역의 데이터에 접근한다.

#### Speculative Execution (스펙 실행)

프로세서에서 성능 향상을 위해 사용하는 최적화 기술 중 하나이다. 당장 필요하지 않은 명령어를 미리 실행시켜 실제로 필요할 때 준비된 상태를 제공하여 실행속도를 높이는 방법이다.

- 조건 분기 명령어
- 예측하여 미리 실행
- 예측이 맞으면 준비된 상태를 제공 -> (성능 향상)
- 예측이 틀리면 그냥 다른 코드를 실행하면 끝

스펙 실행은 실행 속도 측면에서 성능을 향상시킬 수 있지만 스펙터나 멜트다운과 같은 보안 취약점을 야기할 수 있다.
